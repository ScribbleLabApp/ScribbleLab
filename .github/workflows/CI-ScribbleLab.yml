name: CI-ScribbleLab
on:
  pull_request:
    branches:
      - main
  workflow_dispatch:
jobs:
  run-unit-tests:
    name: Run Unit Tests
    runs-on: macos-13
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v3
      - name: Set up Ruby ğŸ’
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: 2.8.0   # newest: 3.2.2 
      - name: Install Slather ğŸ’
        run: gem install slather
      - name: List Xcode Versions ğŸ“‹
        run: ls /Applications | grep Xcode
      - name: Select Xcode âœ¨
        run: sudo xcode-select -switch /Applications/Xcode_15.0.1.app/Contents/Developer
      - name: List SDKs ğŸŠ
        run: xcodebuild -showsdks
      - name: List Simulators ğŸ“±
        run: xcrun simctl list --json
      - name: Run tests (UI & Unit tests) âœ…
        run: xcodebuild -scheme ScribbleLab -sdk iphonesimulator -destination 'platform=iOS Simulator,name=iPad Pro (12.9-inch) (6th generation)' test
      - name: Generate Coverage Report ğŸ’
        run: slather coverage --cobertura-xml
      - name: Upload Coverage to Codecov ğŸ“Š
        uses: codecov/codecov-action@v3
        with:
          file: ./cobertura.xml
        env:
          CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}